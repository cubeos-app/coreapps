# WireGuard VPN Client
# Port: 6020 (UDP)
# Provides VPN connectivity for CubeOS
services:
  wireguard:
    image: linuxserver/wireguard:latest
    container_name: cubeos-wireguard
    restart: unless-stopped
    ports:
      - "6020:51820/udp"
    volumes:
      - ../appdata:/config
      - /lib/modules:/lib/modules:ro
    environment:
      - TZ=${TZ:-UTC}
      - PUID=1000
      - PGID=1000
    env_file:
      - /cubeos/config/defaults.env
    cap_add:
      - NET_ADMIN
      - SYS_MODULE
    sysctls:
      - net.ipv4.conf.all.src_valid_mark=1
      - net.ipv4.ip_forward=1
    deploy:
      resources:
        limits:
          memory: 128M
        reservations:
          memory: 64M
    healthcheck:
      test: ["CMD-SHELL", "wg show | grep -q interface || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    labels:
      - "cubeos.type=network"
      - "cubeos.category=vpn"
      - "cubeos.port=6020"
      - "cubeos.description=WireGuard VPN Client"
