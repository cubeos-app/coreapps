# CubeOS Docs Indexer
# Port: 6032
# Syncs documentation from Git and indexes into ChromaDB for RAG

services:
  docs-indexer:
    build:
      context: ../src
      dockerfile: Dockerfile
    image: ghcr.io/cubeos-app/docs-indexer:latest
    container_name: cubeos-docs-indexer
    restart: unless-stopped
    ports:
      - "6032:8080"
    volumes:
      - /cubeos/docs:/cubeos/docs
    environment:
      - TZ=${TZ:-UTC}
      - DOCS_REPO_URL=${DOCS_REPO_URL:-https://github.com/cubeos-app/docs.git}
      - DOCS_LOCAL_PATH=/cubeos/docs
      - OLLAMA_HOST=10.42.24.1
      - OLLAMA_PORT=6030
      - EMBEDDING_MODEL=${EMBEDDING_MODEL:-nomic-embed-text}
      - CHROMADB_HOST=10.42.24.1
      - CHROMADB_PORT=6031
      - COLLECTION_NAME=${COLLECTION_NAME:-cubeos_docs}
      - SYNC_INTERVAL_HOURS=${SYNC_INTERVAL_HOURS:-6}
      - CHUNK_SIZE=${CHUNK_SIZE:-300}
      - CHUNK_OVERLAP=${CHUNK_OVERLAP:-50}
    env_file:
      - /cubeos/config/defaults.env
    deploy:
      resources:
        limits:
          memory: 256M
        reservations:
          memory: 64M
    labels:
      - "cubeos.type=ai"
      - "cubeos.category=ai"
      - "cubeos.port=6032"
      - "cubeos.description=Documentation Indexer for RAG"
