# OpenVPN Client
# Port: 6021 (UDP)
# Provides OpenVPN connectivity for CubeOS
services:
  openvpn:
    image: dperson/openvpn-client:latest
    container_name: cubeos-openvpn
    restart: unless-stopped
    ports:
      - "6021:1194/udp"
    volumes:
      - ../appdata:/vpn
    environment:
      - TZ=${TZ:-UTC}
    env_file:
      - /cubeos/config/defaults.env
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun:/dev/net/tun
    sysctls:
      - net.ipv6.conf.all.disable_ipv6=0
    deploy:
      resources:
        limits:
          memory: 128M
        reservations:
          memory: 64M
    healthcheck:
      test: ["CMD-SHELL", "pgrep openvpn || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    labels:
      - "cubeos.type=network"
      - "cubeos.category=vpn"
      - "cubeos.port=6021"
      - "cubeos.description=OpenVPN Client"
