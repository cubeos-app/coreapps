# Dozzle - Container Log Viewer
# ═══════════════════════════════════════════════════════════════════════════════
# DEPLOYMENT: Docker Swarm stack
# Port: 6012 (Web UI)
# NOTE: Scratch container - limited healthcheck options
#
# Deploy: docker stack deploy -c docker-compose.yml --resolve-image=never dozzle
# ═══════════════════════════════════════════════════════════════════════════════

services:
  dozzle:
    image: amir20/dozzle:latest
    hostname: cubeos-dozzle
    ports:
      - target: 8080
        published: 6012
        protocol: tcp
        mode: host
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
    environment:
      - TZ=${TZ:-UTC}
      - DOZZLE_LEVEL=info
      - DOZZLE_TAILSIZE=300
      - DOZZLE_NO_ANALYTICS=true
    env_file:
      - /cubeos/config/defaults.env
    deploy:
      mode: replicated
      replicas: 1
      placement:
        constraints:
          - node.role == manager
      resources:
        limits:
          memory: 64M
        reservations:
          memory: 32M
      restart_policy:
        condition: any
        delay: 5s
        max_attempts: 3
        window: 120s
      update_config:
        parallelism: 1
        delay: 10s
        failure_action: rollback
      labels:
        - "cubeos.type=platform"
        - "cubeos.category=monitoring"
        - "cubeos.port=6012"
        - "cubeos.fqdn=logs.cubeos.cube"
        - "cubeos.deployment=swarm"
        - "cubeos.description=Dozzle - Container log viewer"

networks:
  default:
    external: true
    name: cubeos-network
# Swarm deploy zo  1 feb 2026  1:52:10 CET
# redeploy zo  1 feb 2026  2:02:35 CET
